# Техническое задание: pywgpu

## 1. Общие сведения
**pywgpu** — это библиотека на Python, являющаяся точной структурной копией проекта `wgpu` (Rust). Цель проекта — предоставить Python-разработчикам современный, безопасный и высокопроизводительный интерфейс для работы с графическими API через стандарт WebGPU, в точности повторяя внутреннюю архитектуру оригинального репозитория.

## 2. Основные требования
- **Строгая типизация**: Весь код должен быть полностью покрыт аннотациями типов. Использование `Any` запрещено. Проверка типов должна проходить в `pyright` (strict mode).
- **Архитектурная идентичность**: Структура папок и разделение ответственности между модулями должны соответствовать оригинальным крейтам `wgpu`.
- **Производительность**: Использование `CFFI` и `NumPy` для эффективной работы с памятью и нативным слоем.

## 3. Стек технологий и библиотеки
- **CFFI (C Foreign Function Interface)**: Основной инструмент для низкоуровневых биндингов к `wgpu-native`.
- **NumPy**: Для высокопроизводительной работы с буферами, текстурами и массивами данных.
- **Pydantic (v2)**: Для строгой валидации всех дескрипторов и структур типов на стороне Python.
- **Pyright**: Основной инструмент статического анализа (strict mode).
- **Typing Extensions**: Для поддержки расширенных возможностей типизации Python.

## 4. Архитектура (Копия wgpu-rs)
Проект должен быть разделен на следующие ключевые компоненты, соответствующие оригинальным крейтам:

1.  **pywgpu-hal (Hardware Abstraction Layer)**:
    - Реализует бэкенды для конкретных графических API (Vulkan, DX12, Metal, GLES).
    - В Python версии это будет слой, напрямую взаимодействующий с нативными библиотеками через CFFI.

2.  **pywgpu-core**:
    - Реализует логику WebGPU API: управление ресурсами, трекинг состояний и валидация.
    - Вызывает графические API через `pywgpu-hal`.
    - Использует `naga` для трансляции шейдеров.

3.  **pywgpu (User-facing API)**:
    - Основной интерфейс для конечного пользователя.
    - Предоставляет типизированные обертки над `pywgpu-core`.
    - Соответствует "native Rust API" оригинального проекта.

4.  **naga (Shader Translator)**:
    - Транслятор шейдеров (WGSL, GLSL, SPIR-V -> Naga IR -> MSL, HLSL, etc.).
    - Ответственен за валидацию WGSL.
    - В Python будет реализован как полноценный порт оригинальной логики Naga для обеспечения архитектурной идентичности и независимости от нативных бинарных файлов транслятора.

5.  **pywgpu-types**:
    - Общие определения типов и дескрипторов, используемые как в `pywgpu-core`, так и в основном API.
    - Реализуется с использованием Pydantic моделей для обеспечения статической типизации.

## 5. План реализации
1. Создание базовых структур данных в `pywgpu-types`.
2. Подготовка CFFI биндингов для `naga` и базового HAL.
3. Реализация логики ресурсного менеджмента в `pywgpu-core`.
4. Создание высокоуровневого API в `pywgpu`.
5. Верификация через эталонные примеры (Hello Triangle).
